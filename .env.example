# =============================================================================
# Email Engine - Environment Variables (Phase 3 - Production Ready)
# =============================================================================
# IMPORTANT: Copy this file to .env and fill in ALL required values.

# =============================================================================
# API Configuration
# =============================================================================
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=4

# API Keys for authentication (internal tool - simple auth)
API_KEY_CLIENT1=client1-internal-key-2026
API_KEY_CLIENT2=client2-internal-key-2026
API_KEY_ADMIN=admin-master-key-2026

# Legacy API Key (deprecated - for v1 compatibility)
API_KEY=CHANGE-ME-generate-with-openssl-rand-hex-32
HOST=127.0.0.1
PORT=8000

# JWT Authentication (REQUIRED for production)
JWT_SECRET_KEY=CHANGE-ME-generate-with-openssl-rand-hex-32
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# =============================================================================
# Database Configuration (PostgreSQL)
# =============================================================================
POSTGRES_USER=email_engine
POSTGRES_PASSWORD=email_engine_password
POSTGRES_DB=email_engine
DATABASE_URL=postgresql://email_engine:email_engine_password@localhost:5432/email_engine

# =============================================================================
# Redis Configuration
# =============================================================================
REDIS_URL=redis://localhost:6379/0
REDIS_CACHE_DB=1  # Separate DB for cache (0 is for Celery)

# =============================================================================
# Celery Configuration (Background Jobs)
# =============================================================================
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/0

# PowerMTA
PMTA_CONFIG_PATH=/etc/pmta/config
PMTA_BIN_PATH=/usr/sbin/pmta

# MailWizz API (RECOMMENDED — uses REST API instead of MySQL direct)
MAILWIZZ_API_URL=http://mailwizz.local/api
MAILWIZZ_API_PUBLIC_KEY=
MAILWIZZ_API_PRIVATE_KEY=

# MailWizz MySQL (FALLBACK — direct DB access, will be deprecated)
MAILWIZZ_DB_HOST=127.0.0.1
MAILWIZZ_DB_PORT=3306
MAILWIZZ_DB_USER=mailwizz
MAILWIZZ_DB_PASSWORD=
MAILWIZZ_DB_NAME=mailwizz

# =============================================================================
# Multi-Tenant MailWizz Configuration
# =============================================================================
# Tenant 1
MAILWIZZ_CLIENT1_API_URL=https://YOUR_MAILWIZZ_DOMAIN/api
MAILWIZZ_CLIENT1_API_KEY=your_mailwizz_api_key_here
MAILWIZZ_CLIENT1_LIST_ID=your_default_list_id

# Tenant 2
MAILWIZZ_CLIENT2_API_URL=https://YOUR_MAILWIZZ_DOMAIN/api
MAILWIZZ_CLIENT2_API_KEY=your_mailwizz_api_key_here
MAILWIZZ_CLIENT2_LIST_ID=your_default_list_id

# Telegram Alerts (RECOMMENDED — alerts disabled without these)
TELEGRAM_BOT_TOKEN=
TELEGRAM_CHAT_ID=

# =============================================================================
# External Services - Data Sources
# =============================================================================
# Scraper-Pro Integration
SCRAPER_PRO_API_URL=https://scraper-pro.example.com/api
SCRAPER_PRO_API_KEY=your_scraper_pro_key
SCRAPER_PRO_BOUNCE_URL=http://SCRAPER_PRO_IP:8000/api/v1/contacts/bounce-feedback
SCRAPER_PRO_DELIVERY_URL=http://SCRAPER_PRO_IP:8000/api/v1/contacts/delivery-feedback
SCRAPER_PRO_HMAC_SECRET=

# Backlink Engine Integration
BACKLINK_ENGINE_API_URL=https://backlink-engine.example.com/api
BACKLINK_ENGINE_API_KEY=your_backlink_engine_key

# =============================================================================
# Email Validation Configuration
# =============================================================================
EMAIL_VALIDATION_SERVICE=internal  # Options: internal, zerobounce, neverbounce
ZEROBOUNCE_API_KEY=your_zerobounce_key
NEVERBOUNCE_API_KEY=your_neverbounce_key

# Blacklist
BLACKLIST_CHECK_INTERVAL_HOURS=4

# Warmup — Seuils de sécurité (hyper-protecteur, ne pas assouplir en prod)
# Quotas journaliers : définis dans le code (DAILY_QUOTAS, 70 jours)
WARMUP_MAX_BOUNCE_RATE=2.0           # Pause si bounce > 2% sur 7j
WARMUP_MAX_SPAM_RATE=0.03            # Pause si spam > 0.03% sur 7j
WARMUP_EMERGENCY_BOUNCE_RATE=5.0     # Arrêt d'urgence si > 5% sur 24h
WARMUP_EMERGENCY_SPAM_RATE=0.1       # Arrêt d'urgence si > 0.1% sur 24h
WARMUP_PAUSE_BOUNCE_HOURS=72         # 3j de pause sur bounce
WARMUP_PAUSE_SPAM_HOURS=96           # 4j de pause sur spam

# IP Rotation
IP_QUARANTINE_DAYS=30
IP_REST_DAYS=7

# =============================================================================
# Application Settings
# =============================================================================
ENVIRONMENT=development  # Options: development, staging, production
DEBUG=true
LOG_LEVEL=INFO

# CORS Origins (comma-separated)
CORS_ORIGINS=http://localhost:3000,http://localhost:8000

# =============================================================================
# Rate Limiting
# =============================================================================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_PER_MINUTE=60

# =============================================================================
# Monitoring & Alerts
# =============================================================================
SENTRY_DSN=
SLACK_WEBHOOK_URL=
SLACK_ALERT_CHANNEL=#email-alerts

# =============================================================================
# Webhook Security (RECOMMANDÉ en production)
# =============================================================================
# Secret HMAC partagé avec PowerMTA pour signer les payloads webhook
# Générer avec : openssl rand -hex 32
WEBHOOK_SECRET=

# IPs autorisées à appeler les webhooks (comma-separated, vide = pas de restriction)
# Mettre les IPs de vos VPS PowerMTA
PMTA_ALLOWED_IPS=

# =============================================================================
# Monitoring — Grafana
# =============================================================================
# URL publique Grafana (ex: https://monitoring.votre-domaine.com)
GRAFANA_ROOT_URL=http://localhost:3000
GRAFANA_PASSWORD=
